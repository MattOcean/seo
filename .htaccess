

# ~~start~~ Do not remove this comment, Prestashop will keep automatically the code outside this comment when .htaccess will be generated again
# .htaccess automaticaly generated by PrestaShop e-commerce open-source solution
# http://www.prestashop.com - http://www.prestashop.com/forums

<IfModule mod_rewrite.c>
<IfModule mod_env.c>
SetEnv HTTP_MOD_REWRITE On
</IfModule>
<IfModule mod_rewrite.c>
RewriteCond %{HTTPS} off
RewriteRule (.*) https://www.rodentia.es/$1 [R=301,L,QSA]

</IfModule>

RewriteEngine on
RewriteRule . - [E=REWRITEBASE:/]
RewriteRule ^api/?(.*)$ %{ENV:REWRITEBASE}webservice/dispatcher.php?url=$1 [QSA,L]      

# Images
RewriteRule ^([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$1$2$3.jpg [L]
RewriteRule ^([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$1$2$3$4.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$1$2$3$4$5.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$4/$1$2$3$4$5$6.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$4/$5/$1$2$3$4$5$6$7.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$4/$5/$6/$1$2$3$4$5$6$7$8.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$4/$5/$6/$7/$1$2$3$4$5$6$7$8$9.jpg [L]
RewriteRule ^([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])([0-9])(\-[_a-zA-Z0-9-]*)?(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/p/$1/$2/$3/$4/$5/$6/$7/$8/$1$2$3$4$5$6$7$8$9$10.jpg [L]
RewriteRule ^c/([0-9]+)(\-[\.*_a-zA-Z0-9-]*)(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/c/$1$2$3.jpg [L]
RewriteRule ^c/([a-zA-Z_-]+)(-[0-9]+)?/.+\.jpg$ %{ENV:REWRITEBASE}img/c/$1$2.jpg [L]
# AlphaImageLoader for IE and fancybox
RewriteRule ^images_ie/?([^/]+)\.(jpe?g|png|gif)$ js/jquery/plugins/fancybox/images/$1.$2 [L]

# Dispatcher
RewriteCond %{REQUEST_FILENAME} -s [OR]
RewriteCond %{REQUEST_FILENAME} -l [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^.*$ - [NC,L]
RewriteRule ^.*$ %{ENV:REWRITEBASE}index.php [NC,L]
</IfModule>

AddType application/vnd.ms-fontobject .eot
AddType font/ttf .ttf
AddType font/otf .otf
AddType application/x-font-woff .woff

<IfModule mod_expires.c>
	ExpiresActive On
	ExpiresByType image/gif "access plus 1 month"
	ExpiresByType image/jpeg "access plus 1 month"
	ExpiresByType image/png "access plus 1 month"
	ExpiresByType text/css "access plus 1 week"
	ExpiresByType text/javascript "access plus 1 week"
	ExpiresByType application/javascript "access plus 1 week"
	ExpiresByType application/x-javascript "access plus 1 week"
	ExpiresByType image/x-icon "access plus 1 year"
	ExpiresByType image/svg+xml "access plus 1 year"
	ExpiresByType image/vnd.microsoft.icon "access plus 1 year"
	ExpiresByType application/font-woff "access plus 1 year"
	ExpiresByType application/x-font-woff "access plus 1 year"
	ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
	ExpiresByType font/opentype "access plus 1 year"
	ExpiresByType font/ttf "access plus 1 year"
	ExpiresByType font/otf "access plus 1 year"
	ExpiresByType application/x-font-ttf "access plus 1 year"
	ExpiresByType application/x-font-otf "access plus 1 year"
</IfModule>

FileETag INode MTime Size
<IfModule mod_deflate.c>
	<IfModule mod_filter.c>
		AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/x-javascript
	</IfModule>
</IfModule>

#If rewrite mod isn't enabled
ErrorDocument 404 /index.php?controller=404

# ~~end~~ Do not remove this comment, Prestashop will keep automatically the code outside this comment when .htaccess will be generated again

RewriteCond %{HTTP_HOST} ^cd1\.rodentia\.es$ [OR]
RewriteCond %{HTTP_HOST} ^www\.cd1\.rodentia\.es$
RewriteRule ^/?$ "http\:\/\/www\.rodentia\.es" [R=301,L]

RewriteCond %{HTTP_HOST} ^cd2\.rodentia\.es$ [OR]
RewriteCond %{HTTP_HOST} ^www\.cd2\.rodentia\.es$
RewriteRule ^/?$ "http\:\/\/www\.rodentia\.es" [R=301,L]

RewriteCond %{HTTP_HOST} ^cd3\.rodentia\.es$ [OR]
RewriteCond %{HTTP_HOST} ^www\.cd3\.rodentia\.es$
RewriteRule ^/?$ "http\:\/\/www\.rodentia\.es" [R=301,L]



#ifModule mod_gzip.c>
#od_gzip_on Yes
#od_gzip_dechunk Yes
#od_gzip_item_include file .(html?|txt|css|js|php|pl)$
#od_gzip_item_include handler ^cgi-script$
#od_gzip_item_include mime ^text/.*
#od_gzip_item_include mime ^application/x-javascript.*
#od_gzip_item_exclude mime ^image/.*
#od_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
#/ifModule>



<ifModule mod_headers.c>
    Header set Connection keep-alive
</ifModule>



<IfModule mod_deflate.c>
    #The following line is enough for .js and .css
    AddOutputFilter DEFLATE js css

    #The following line also enables compression by file content type, for the following list of Content-Type:s
    AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml

    #The following lines are to avoid bugs with some browsers
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html 
</IfModule>


<IfModule mod_headers.c>
<FilesMatch "\.(js|css|gz)$">
 Header append Vary: Accept-Encoding
</FilesMatch>
</IfModule>


<IfModule mod_headers.c>
<FilesMatch "\.(php)$">
 Header set Cache-Control "max-age=300"
 Header append Vary: Accept-Encoding
</FilesMatch>
</IfModule>

<IfModule mod_rewrite.c>
     # You may need to un-comment the following lines
     # Options +FollowSymlinks
     # To make sure that rewritten dir or file (/|.html) will not load dir.php in case it exist
     # Options -MultiViews
     # REMEBER YOU ONLY NEED TO STARD MOD REWRITE ONCE
     RewriteEngine On

     # Uncomment the statement below if you want to make use of
     # HTTP authentication and it does not already work.
     # This could be required if you are for example using PHP via Apache CGI.
     # RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]

     # REWRITE BASE
     RewriteBase /

     

     # DO NOT GO FURTHER IF THE REQUESTED FILE / DIR DOES EXISTS
     RewriteCond %{REQUEST_FILENAME} -f [OR]
     RewriteCond %{REQUEST_FILENAME} -d
     RewriteRule . - [L]
     # FORUM INDEX REWRITERULE WOULD STAND HERE IF USED. "forum" REQUIRES TO BE SET AS FORUM INDEX
     # RewriteRule ^foro/forum\.html$ /foro/index.php [QSA,L,NC]
     # FORUM ALL MODES
     RewriteRule ^foro/(forum|[a-z0-9_-]*-f)([0-9]+)/?(page([0-9]+)\.html)?$ /foro/viewforum.php?f=$2&start=$4 [QSA,L,NC]
     # TOPIC WITH VIRTUAL FOLDER ALL MODES
     RewriteRule ^foro/(forum|[a-z0-9_-]*-f)([0-9]+)/(topic|[a-z0-9_-]*-t)([0-9]+)(-([0-9]+))?\.html$ /foro/viewtopic.php?f=$2&t=$4&start=$6 [QSA,L,NC]
     # TOPIC WITHOUT FORUM ID & DELIM ALL MODES
     RewriteRule ^foro/([a-z0-9_-]*)/?(topic|[a-z0-9_-]*-t)([0-9]+)(-([0-9]+))?\.html$ /foro/viewtopic.php?forum_uri=$1&t=$3&start=$5 [QSA,L,NC]
     # PROFILES THROUGH USERNAME
     RewriteRule ^foro/member/([^/]+)/?$ /foro/memberlist.php?mode=viewprofile&un=$1 [QSA,L,NC]
     # USER MESSAGES THROUGH USERNAME
     RewriteRule ^foro/member/([^/]+)/(topics|posts)/?(page([0-9]+)\.html)?$ /foro/search.php?author=$1&sr=$2&start=$4 [QSA,L,NC]
     # GROUPS ALL MODES
     RewriteRule ^foro/(group|[a-z0-9_-]*-g)([0-9]+)(-([0-9]+))?\.html$ /foro/memberlist.php?mode=group&g=$2&start=$4 [QSA,L,NC]
     # POSTS
     RewriteRule ^foro/post([0-9]+)\.html$ /foro/viewtopic.php?p=$1 [QSA,L,NC]
     # ACTIVE TOPICS
     RewriteRule ^foro/active-topics(-([0-9]+))?\.html$ /foro/search.php?search_id=active_topics&start=$2&sr=topics [QSA,L,NC]
     # UNANSWERED TOPICS
     RewriteRule ^foro/unanswered(-([0-9]+))?\.html$ /foro/search.php?search_id=unanswered&start=$2&sr=topics [QSA,L,NC]
     # NEW POSTS
     RewriteRule ^foro/newposts(-([0-9]+))?\.html$ /foro/search.php?search_id=newposts&start=$2&sr=topics [QSA,L,NC]
     # UNREAD POSTS
     RewriteRule ^foro/unreadposts(-([0-9]+))?\.html$ /foro/search.php?search_id=unreadposts&start=$2 [QSA,L,NC]
     # THE TEAM
     RewriteRule ^foro/the-team\.html$ /foro/memberlist.php?mode=team [QSA,L,NC]
     # HERE IS A GOOD PLACE TO ADD OTHER PHPBB RELATED REWRITERULES
     
     # FORUM WITHOUT ID & DELIM ALL MODES
     # THESE LINES MUST BE LOCATED AT THE END OF YOUR HTACCESS TO WORK PROPERLY
     RewriteCond %{REQUEST_FILENAME} !-f
     RewriteCond %{REQUEST_FILENAME} !-d
     RewriteRule ^foro/([a-z0-9_-]+)/?(page([0-9]+)\.html)?$ /foro/viewforum.php?forum_uri=$1&start=$3 [QSA,L,NC]
     # FIX RELATIVE PATHS : FILES
     RewriteRule ^foro/(style\.php|ucp\.php|mcp\.php|faq\.php|posting\.php|download/file\.php|report\.php|adm/index\.php|cron\.php)$ /foro/$1 [QSA,L,NC,R=301]
     # FIX RELATIVE PATHS : IMAGES
     RewriteRule ^foro/(styles/.*|images/.*|assets/.*|ext/.*)$ /foro/$1 [QSA,L,NC,R=301]
     #
     # The following 3 lines will rewrite URLs passed through the front controller
     # to not require app.php in the actual URL. In other words, a controller is
     # by default accessed at /app.php/my/controller, but can also be accessed at
     # /my/controller
     #
     RewriteCond %{REQUEST_FILENAME} !-f
     RewriteCond %{REQUEST_FILENAME} !-d
     RewriteRule ^foro/(.*)$ /foro/app.php [QSA,L]

</IfModule>

# With Apache 2.4 the "Order, Deny" syntax has been deprecated and moved from
# module mod_authz_host to a new module called mod_access_compat (which may be
# disabled) and a new "Require" syntax has been introduced to mod_authz_host.
# We could just conditionally provide both versions, but unfortunately Apache
# does not explicitly tell us its version if the module mod_version is not
# available. In this case, we check for the availability of module
# mod_authz_core (which should be on 2.4 or higher only) as a best guess.
<IfModule mod_version.c>
     <IfVersion < 2.4>
          <Files "config.php">
               Order Allow,Deny
               Deny from All
          </Files>
          <Files "common.php">
               Order Allow,Deny
               Deny from All
          </Files>
     </IfVersion>
     <IfVersion >= 2.4>
          <Files "config.php">
               Require all denied
          </Files>
          <Files "common.php">
               Require all denied
          </Files>
     </IfVersion>
</IfModule>
<IfModule !mod_version.c>
     <IfModule !mod_authz_core.c>
          <Files "config.php">
               Order Allow,Deny
               Deny from All
          </Files>
          <Files "common.php">
               Order Allow,Deny
               Deny from All
          </Files>
     </IfModule>
     <IfModule mod_authz_core.c>
          <Files "config.php">
               Require all denied
          </Files>
          <Files "common.php">
               Require all denied
          </Files>
     </IfModule>
</IfModule>
